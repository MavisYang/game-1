var modelFlag=!1,para=!1,btnFlag=!0,postInfoData=new Object,controller={init:function(){this.getInitData(),this.closeModel(),this.postInfo(),this.lotteryAgain()},getInitData:function(){$.ajax({url:groupIp+"moac/selectMoRecord?openid="+openid,type:"get",success:function(e){var t,n,a,o=e.data;if("F"===o.isMore)if(""!==o.records&&null!==o.records&&void 0!==o.records&&0<o.records.length)for(var s in o.records)"e"===o.records[s].rewardType?(t="unDoneBtn",!(n="点击领取")):"t"===o.records[s].rewardType&&("T"===o.records[s].address?(t="doneBtn",n="已提交","disabled"):(t="unDoneBtn",!(n="提交地址"))),a='<div class="lotteryBox"><span class="coupon">'+o.records[s].rewardName+"</span><button class="+t+" id="+o.records[s].id+" onclick=eventFunctions.negative(this) name="+o.records[s].rewardId+o.records[s].elecUrl+">"+n+"</button></div>",$(".wrap").append(a),"T"===o.records[s].address&&"t"===o.records[s].rewardType&&$("button[id="+o.records[s].id+"]").attr("disabled",!0),(btnFlag=!1)||$(".againLottery").css("display","none");else(btnFlag=!1)||$(".againLottery").css("display","none"),a='<div class="prompt"><img src="image/liziShort-02.png" alt=""><p>您已抽奖,<br>谢谢参与</p></div>',$(".wrap").empty().append(a);else"T"===o.isMore&&(a='<div class="prompt"><img src="image/liziShort-02.png" alt=""><p>您还没有抽奖哦,<br>快去抽奖吧～</p></div>',$(".wrap").empty().append(a))}.bind(this)})},handleAddress:function(e){var t=2==e.length?e[0].value+e[1].value:e[0].value+e[1].value+e[2].value,n=2==e.length?e[0].value+"-"+e[1].value:e[0].value+"-"+e[1].value+"-"+e[2].value;$("#address").val(t).attr("name","city"+n)},closeModel:function(){$(".modelClose").click(function(){para=modelFlag=!1,eventFunctions.handleModel()})},lotteryAgain:function(){$(".againBtn").click(function(){window.location.href="index.html"})},postInfo:function(){$(".fill_submit").click(function(t){var n=!0;$("input[type=text]").map(function(e,t){if(""==t.value)return n=!1;"address"==t.id?postInfoData.city=t.name.substr(4):postInfoData[t.name]=t.value});try{if(0==n)throw"请完善信息"}catch(e){return alert(e),!1}try{var e=$("input[name=phone]");if(!/^1[34578]\d{9}$/.test(e.val()))throw"请输入正确手机号"}catch(e){return alert(e),$("input[name=phone]").focus(),!1}postInfoData.recordId=t.target.id,$.ajax({url:groupIp+"moac/insertMoAddress",type:"post",data:postInfoData,success:function(e){if(200==e.status){modelFlag=!1,eventFunctions.handleModel();$(".shadowBox").css({display:"block"}).empty().append('<div class="success-icon"></div><div style="width: 80%;height: 80px;display: table-cell;vertical-align: middle;">提交成功</div>'),$("button[id="+t.target.id+"]").attr("disabled",!0).removeClass("unDoneBtn").addClass("doneBtn").text("已提交"),setInterval(function(){$(".shadowBox").css({display:"none"})},2e3)}}.bind(this)})})}},eventFunctions={negative:function(e){"t"===e.name.substr(0,1)?(modelFlag=!0,this.handleModel(),$(".fill_submit").attr("id",e.id),new MultiPicker({input:"address",container:"addressContainer",jsonData:$city,success:function(e){controller.handleAddress(e)}})):"e"===e.name.substr(0,1)&&(window.location.href=e.name.substr(3).trim())},handleModel:function(){$(".popupModel")[0].style.display=0==modelFlag?"none":"block",$(".userInfo")[0].style.display=0==modelFlag?"none":"block"}};