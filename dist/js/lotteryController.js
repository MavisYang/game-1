var Flag,modelFlag=!1,para=0,ruleFlag=!0,isMoreFlag=!0,isEmptyFlag=!1,controller={init:function(){modelFlag?$(".stopLottery").css("display","block"):(this.getInitData(),this.closeModel(),this.getPrize(),this.getReward(),this.postInfo()),eventFunctions.handleModel()},getInitData:function(){$.ajax({url:groupIp+"moac/verifyLoadReward?openid="+openid,type:"get",success:function(t){200==t.status&&("F"==t.data.isMore?(console.log(1),isMoreFlag=!1):"T"==t.data.isEmpty&&(console.log(2),isEmptyFlag=!0),this.lottery())}.bind(this)})},lottery:function(){$(".butt").click(function(){return isMoreFlag?isEmptyFlag?(modelFlag=!0,para=2,eventFunctions.handleModel(),$(".partTitle").empty().text("很遗憾，奖品已抽完"),$(".partIMG").css({background:"url('image/liziShort.png')no-repeat","background-size":"contain"}),$(".partState").empty().text("谢谢您的参与～"),void $(".negativeButton").val("查  看").attr("name","history.html")):void(Flag||(Flag=!0,$(this).attr("disabled",!0),eventFunctions.rotate())):(modelFlag=!0,para=2,eventFunctions.handleModel(),$(".partTitle").text("不要太贪心哦～"),$(".partIMG").css({background:"url('image/liziShort.png') no-repeat","background-size":"contain"}),$(".partState").empty().text("每位宝妈只能抽取一次"),void $(".negativeButton").val("查  看").attr("name","history.html"))})},closeModel:function(){$(".modelClose").click(function(){ruleFlag=!(modelFlag=!1),para=0,eventFunctions.handleModel()})},handleAddress:function(t){var e=2==t.length?t[0].value+t[1].value:t[0].value+t[1].value+t[2].value,a=2==t.length?t[0].value+"-"+t[1].value:t[0].value+"-"+t[1].value+"-"+t[2].value;$("#address").val(e).attr("name","city"+a)},getPrize:function(){$(".negativeButton").click(function(t){"JUMP"!==t.target.name?"history.html"!==t.target.name?"t"===t.target.name.substr(0,1)?(para=1,eventFunctions.handleModel(),$(".fill_submit").attr("id",t.target.id),new MultiPicker({input:"address",container:"addressContainer",jsonData:$city,success:function(t){controller.handleAddress(t)}})):window.location.href=t.target.name.substr(3).trim():window.location.href=t.target.name:$(".modelClose").trigger("click")})},getReward:function(){$(".history").click(function(){window.location.href="history.html"})},postInfo:function(){$(".fill_submit").click(function(t){var a=!0,n=new Object;$("input[type=text]").map(function(t,e){if(""==e.value)return a=!1;"address"==e.id?n.city=e.name.substr(4):n[e.name]=e.value});try{if(0==a)throw"请完善信息"}catch(t){return alert(t),!1}try{var e=$("input[name=phone]");if(!/^1[34578]\d{9}$/.test(e.val()))throw"请输入正确手机号"}catch(t){return alert(t),$("input[name=phone]").focus(),!1}n.recordId=t.target.id,$.ajax({url:groupIp+"moac/insertMoAddress",type:"post",data:n,success:function(t){if(200==t.status){modelFlag=!1,para=0,eventFunctions.handleModel();$(".shadowBox").css({display:"block"}).empty().append('<div class="success-icon"></div><div style="width: 80%;height: 80px;display: table-cell;vertical-align: middle;">提交成功</div>'),setInterval(function(){$(".shadowBox").css({display:"none"})},2e3)}}})})}},eventFunctions={setDegree:function(t,e){t.css({transform:"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)"})},rotate:function(){var t,e=this;Flag=!1;var a,n,o=$(".inner"),i=100,l=0,r=[],s=null,d=null,c="",u="",p="",g="",m="",v=null,y=!1,h=!1,f=!1,b="";for(r[1]=[.2,.4,.6,.8,1,1,1.2,1.4,1.6,1.8],r[2]=[1.8,1.6,1.4,1.2,1,1,.8,.6,.4,.2],$.ajax({url:groupIp+"moac/loadMoReward?openid="+openid,type:"get",dataType:"json",success:function(t){200==t.status?(isMoreFlag="F"!=t.data.isMore||(console.log(1212),!1),console.log(23232),s=parseInt(t.data.rewardId.substr(1)%6-2),console.log(s,"offset"),c=t.data.rewardId,u=t.data.rewardType,v=t.data.recordId,p=t.data.nickname,g=t.data.price,m=t.data.elecUrl):10010==t.status?h=!0:10012==t.status?f=!0:500==t.status&&(y=!0,b=t.msg)}}),a=0;a<100;a++)setTimeout(function(){t=9*r[String(i).substr(0,1)][String(i).substr(1,1)]*2,e.setDegree(o,t+l),l+=t,i++},50*a);setTimeout(function(){for(d=9-(.6*(s=null==s?.5:s)-.3),n=0;n<100;n++)setTimeout(function(){t=d*r[2][String(i).substr(1,1)],e.setDegree(o,t+l),l+=t,i++},50*n)},5e3),setTimeout(function(){if($(".butt").removeAttr("disabled"),1!=y){if(1==h)return modelFlag=!0,para=2,eventFunctions.handleModel(),$(".partTitle").text("不要太贪心哦～"),$(".partIMG").css({background:"url('image/liziShort.png') no-repeat","background-size":"contain"}),$(".partState").empty().text("每位宝妈只能抽取一次哦～"),void $(".negativeButton").val("查  看").attr("name","history.html");if(1==f)return modelFlag=!0,para=2,eventFunctions.handleModel(),$(".partTitle").empty().text("很遗憾，奖品已抽完"),$(".partIMG").css({background:"url('image/liziShort.png') no-repeat","background-size":"contain"}),$(".partState").empty().text("谢谢您的参与～"),void $(".negativeButton").val("返  回").attr("id",v).attr("name","JUMP");if(""==u){return $(".shadowBox").css({display:"block"}).empty().append('<div class="fresh-icon"></div><div style="width: 80%;height: 80px;display: table-cell;vertical-align: middle;">网络不稳定请刷新重试</div>'),void setInterval(function(){$(".shadowBox").css({display:"none"})},2e3)}e.setModel(s,u,v,p,g,m,c)}else alert(b)},10500)},setModel:function(t,e,a,n,o,i,l){var r;modelFlag=!0,para=2,this.handleModel(),$(".partTitle").text("恭喜您!"),"e"===e&&(r="image/gift_"+l.slice(1)+".png",$(".partState").empty().text("获得该奖品"),$(".partIMG").css({background:"url("+r+")no-repeat","background-size":"contain"}),$(".negativeButton").val("领取电子券").attr("id",a).attr("name",l+i)),"t"===e&&(r="image/gift_"+l.slice(1)+".png",$(".partState").empty().text("获得该奖品"),$(".partIMG").css({background:"url("+r+")no-repeat","background-size":"contain"}),$(".negativeButton").val("领取实物礼品").attr("id",a).attr("name",l+i))},handleModel:function(){$(".popupModel")[0].style.display=0==modelFlag?"none":"block",$(".btnContainer")[0].style.display=0==ruleFlag?"none":"block",2==para?($(".partStatus")[0].style.display="block",$(".userInfo")[0].style.display="none"):1==para?($(".partStatus")[0].style.display="none",$(".userInfo")[0].style.display="block"):3==para&&($(".partStatus")[0].style.display="none",$(".userInfo")[0].style.display="none")}};